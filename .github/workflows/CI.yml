name: CI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash -el {0}
    steps:
      - name: Pull code
        uses: actions/checkout@v5

      - name: Setup conda
        uses: conda-incubator/setup-miniconda@v3
        with:
          activate-environment: any2fasta
          environment-file: environment.yml
          miniforge-version: latest
          channels: conda-forge,bioconda
          channel-priority: strict
          auto-update-conda: true

      - name: Set PATH
        run: |
          echo "$GITHUB_WORKSPACE" >> $GITHUB_PATH

      - name: Testing
        run: |
          any2fasta -v
          any2fasta -h
          any2fasta test.gbk | grep -m 3 '^>'
          any2fasta test.gff | grep -m 3 '^>'
          any2fasta test.fna | grep -m 3 '^>'
          any2fasta test.gfa | grep -m 3 '^>'
          any2fasta test.fq  | grep -m 3 '^>'
          any2fasta test.embl | grep -m 3 '^>'
          any2fasta test.clw  | grep -m 3 '^>'
          any2fasta test.sth  | grep -m 3 '^>'
          any2fasta    test.fna | grep 'CRYANT'
          any2fasta -n test.fna | grep 'CNNANT'
          any2fasta test.gfa | grep '^>24292$'
          any2fasta test.fq | grep '^>ERR1163317.999'
          any2fasta test.sth | grep '^>O83071'
          any2fasta test.clw | grep '^>gene03'
          any2fasta -l test.gbk | grep 'taagaatgagtagaaggttttga'
          any2fasta -u test.gbk | grep 'TAAGAATGAGTAGAAGGTTTTGA'
          any2fasta -u test.embl | grep 'K02675'
          any2fasta -q -l -n test.fq | wc -l | grep '^2000$'
          any2fasta - < test.gbk  | grep -m 1 -F 'NZ_AHMY02000074'
          gzip -c test.gbk | any2fasta - | grep -m 1 -F 'NZ_AHMY02000074'
          bzip2 -c test.gbk | any2fasta - | grep -m 1 -F 'NZ_AHMY02000074'
          zip test.gbk.zip test.gbk
          any2fasta test.gbk.zip | grep -m 1 -F 'NZ_AHMY02000074'
          echo -e ">1\nA\n\n>2\nT\n" | any2fasta -q - | wc -l | grep '^4$'
